$ErrorActionPreference = 'Stop'
Set-PSDebug -Strict

function Test-PowershellCore() {
	$PSVersionTable.PSEdition -eq 'Core'
}

function Invoke-Build([string] $folder) {
	write-host "Invoke-Build: $folder"
	pushd $folder
	if (Test-PowershellCore) {
		pwsh .\build.ps1
	} else {
		powershell .\build.ps1
	}
	if ($LASTEXITCODE -ne 0) {
		exit $LASTEXITCODE
	}
	popd
}

Invoke-Build blackduck # depends on codedx-blackduckrunnerbase, which requires Black-Duck-Scrape.jar (generated by a Code Dx build).
Invoke-Build blackduck-dotnet
Invoke-Build blackduck-go
Invoke-Build blackduck-sbt
Invoke-Build burpsuite
Invoke-Build checkmarx
Invoke-Build coverity
Invoke-Build coverity-dotnet
Invoke-Build coverity-go
Invoke-Build coverity-sbt
Invoke-Build golangci-lint
Invoke-Build gosec
Invoke-Build govet
Invoke-Build securitycodescan
Invoke-Build staticcheck
Invoke-Build zap

